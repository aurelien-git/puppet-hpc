<% conf  = @data -%>
<% nsep  = @separator -%>
<% comm  = @comments -%>
<% excep = @exceptions -%>
<% esep  = @excep_separator -%>
<% style = @style -%>
<%= comm %>####################################################################
<%= comm %> NOTE: This file is automatically generated by puppet.
<%= comm %> Changes to this file will be overwritten periodically by puppet!
<%= comm %>####################################################################
<%= comm %> TEMPLATE: {<%= @name %>}/<%= File.basename(__FILE__) %>}
<%= comm %>####################################################################
<% case style -%>
  <%- when 'ini' -%>
  <%- conf.each do | section, content | -%>
<%= '['+section+']' %>
    <%- content.each do | key, kcont | -%>
      <%- if excep.include? key -%>
        <%- sep = esep -%>
      <%- else -%>
        <%- sep = nsep -%>
      <%- end -%>
      <%- if kcont.is_a? String -%>
<%= key+sep+kcont %>
      <%- else -%>
        <%- if kcont.key?('comment') and !kcont['comment'].empty? then -%>
<%= comm+' '+kcont['comment'] %>
        <%- end -%>
<%= key+sep+kcont['value'] %>
      <%- end -%>
    <%- end -%>

  <%- end -%>
  <%- when 'ini_flat' -%>
  <%- conf.map do | key, kcont | -%>
    <%- if kcont.key?('comment') and !kcont['comment'].empty? then -%>
<%=comm+' '+kcont["comment"] %>
    <%- end -%>
    <%- unless kcont["value"].empty? then -%>
      <%- if excep.include? key -%>
        <%- sep = esep -%>
      <%- else -%>
        <%- sep = nsep -%>
      <%- end -%>
<%= key+sep+kcont["value"] %>
    <%- end -%>

  <%- end %>
  <%- when 'keyval' -%>
  <%- conf.sort.map do | key, kcont | -%>
    <%- unless kcont.empty? then -%>
      <%- if excep.include? key -%>
        <%- sep = esep -%>
      <%- else -%>
        <%- sep = nsep -%>
      <%- end -%>
<%= key+sep+kcont %>
    <%- end -%>
  <%- end %>
  <%- when 'linebyline' -%>
  <%- conf.each do | element | -%>
<%= element %>
  <%- end -%>
  <%- when 'yaml' -%>
<%= conf.to_yaml() %>
<% end -%>
