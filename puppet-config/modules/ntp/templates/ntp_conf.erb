<% ########################################################################## -%>
<% #  Puppet configuration file                                             # -%>
<% #                                                                        # -%>
<% #  Copyright (C) 2014-2015 EDF S.A.                                      # -%>
<% #  Contact: CCN-HPC <dsp-cspit-ccn-hpc@edf.fr>                           # -%>
<% #                                                                        # -%>
<% #  This program is free software; you can redistribute in and/or         # -%>
<% #  modify it under the terms of the GNU General Public License,          # -%>
<% #  version 2, as published by the Free Software Foundation.              # -%>
<% #  This program is distributed in the hope that it will be useful,       # -%>
<% #  but WITHOUT ANY WARRANTY; without even the implied warranty of        # -%>
<% #  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         # -%>
<% #  GNU General Public License for more details.                          # -%>
<% ########################################################################## -%>

#####################################################################
# NTPD configuration file
#####################################################################
# NOTE: This file is automatically generated by puppet.
# Changes to this file will be overwritten periodically by puppet!
#####################################################################
# TEMPLATE: {<%= @name %>}/<%= File.basename(__FILE__) %>} 
#####################################################################
<% preferred_servers = Array.new -%>
<% servers = Array.new -%>
<%- preferred_servers = @preferred_servers if @preferred_servers != nil -%>
<%- servers = @servers if @servers != nil -%>


driftfile /var/lib/ntp/ntp.drift
statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

<% if preferred_servers -%>
  <%- preferred_servers.each do | srv | -%>
<%= "server "+srv+" prefer" if srv.length > 0 %>
  <%- end -%>
<% end -%>
<% if servers -%>
  <%- servers.each do | srv | -%>
<%= "server "+srv %>
  <%- end -%>
<% end -%>

restrict -4 default kod notrap nomodify nopeer
restrict -6 default kod notrap nomodify nopeer

<% if @restrict != [] -%>
<% @restrict.flatten.each do |restrict| -%>
restrict <%= restrict %>
<% end -%>
<% end -%>

restrict 127.0.0.1
restrict ::1

disable auth
