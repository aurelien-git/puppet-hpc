<% ########################################################################## -%>
<% #  Puppet configuration file                                             # -%>
<% #                                                                        # -%>
<% #  Copyright (C) 2014-2015 EDF S.A.                                      # -%>
<% #  Contact: CCN-HPC <dsp-cspit-ccn-hpc@edf.fr>                           # -%>
<% #                                                                        # -%>
<% #  This program is free software; you can redistribute in and/or         # -%>
<% #  modify it under the terms of the GNU General Public License,          # -%>
<% #  version 2, as published by the Free Software Foundation.              # -%>
<% #  This program is distributed in the hope that it will be useful,       # -%>
<% #  but WITHOUT ANY WARRANTY; without even the implied warranty of        # -%>
<% #  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         # -%>
<% #  GNU General Public License for more details.                          # -%>
<% ########################################################################## -%>

#####################################################################
# Hostnames configuration file
#####################################################################
# NOTE: This file is automatically generated by puppet.
# Changes to this file will be overwritten periodically by puppet!
#####################################################################
# TEMPLATE: {<%= @name %>}/<%= File.basename(__FILE__) %>}
#####################################################################
<% # Import Hash Tables -%>
<% hostconf = MasterNetwork::HOSTFILE -%>
<% prefixes = @net_cm_prefixes -%>
<% defaultgw = @net_cm_defaultgw -%>
<% hostfile = Hash.new -%>
<% separator = "\t\t" -%>
<% prefixes.keys.each do | prf| -%>
  <%- il = prf.length -%>
  <%- hostconf.sort.map do | key, value | -%>
    <%- if key.to_s.slice(0..il.to_i).include?(prf) -%>
      <%- tmp = if hostfile.has_key?(prf) then hostfile[prf] else Array.new end -%>
      <%- tmp.push(value+separator+key) unless tmp.include?(value+separator+key) -%>
      <%- hostfile[prf] = tmp -%>
    <%- elsif key.include?('.') -%>
      <%- tmp = if hostfile.has_key?("ext") and defaultgw.length > 0 then hostfile["ext"] else Array.new end -%>
      <%- tmp.push(value+separator+key) unless tmp.include?(value+separator+key) -%>
      <%- hostfile["ext"] = tmp -%>
    <%- end -%>
  <%- end -%>
<% end -%>
<% hostfile["aloc"] = ["127.0.0.1"+separator+"localhost"] -%>
<% prefixes.keys.sort.each do | prf| -%>
  <%- if hostfile.has_key?(prf) -%>
<%= prefixes[prf] %>
    <%- hostfile[prf].sort.each do | line | -%>
<%= line %>
    <%- end -%>
  <%- end -%>
<% end -%>
