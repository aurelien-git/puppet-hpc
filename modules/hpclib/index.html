<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="puppet_manifest_list_link"
        href="puppet_manifest_list.html">
      Puppet Manifest List
    </a>
  
    <a class="full_list_link" id="puppet_plugin_list_link"
        href="puppet_plugin_list.html">
      Puppet Plugin List
    </a>
  
    <a class="full_list_link" id="puppet_type_list_link"
        href="puppet_type_list.html">
      Puppet Type List
    </a>
  
    <a class="full_list_link" id="puppet_provider_list_link"
        href="puppet_provider_list.html">
      Puppet Provider List
    </a>
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>hpclib</h1>

<h4>Table of Contents</h4>

<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#module-description">Module Description</a></li>
<li><a href="#setup">Setup</a>

<ul>
<li><a href="#what-hpclib-affects">What hpclib affects</a></li>
<li><a href="#setup-requirements">Setup requirements</a></li>
<li><a href="#beginning-with-hpclib">Beginning with hpclib</a></li>
</ul></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#reference">Reference</a></li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#development">Development</a></li>
</ol>

<h2>Overview</h2>

<p>Facts, function and resources used to build the HPC configuration.</p>

<h2>Module Description</h2>

<p>This module provides building blocks to:</p>

<ul>
<li>Extract data from the cluster definition in hiera</li>
<li>Define functions and resources used by the rest of the configuration</li>
</ul>

<h2>Setup</h2>

<h3>What hpclib affects</h3>

<ul>
<li>Define facts and functions</li>
</ul>

<h3>Setup Requirements</h3>

<p>This module requires pluginsync to make facts work in an agent/master
configuration. </p>

<p>The module require <code>clustershell</code> to be installed on the master or on all
nodes if you are masterless. </p>

<h3>Beginning with hpclib</h3>

<p>hpclib facts relies on a cluster definition in hiera:
<a href="https://github.com/edf-hpc/puppet-hpc/wiki/Cluster%20Definition">https://github.com/edf-hpc/puppet-hpc/wiki/Cluster%20Definition</a></p>

<h2>Usage</h2>

<p>This module is not used directly, but can be used by <em>profiles</em> or non generic
modules to get the cluster definition from facts and functions.</p>

<p>Resources can be used by generic modules to implement some constructs often
found like:</p>

<ul>
<li>Configuration files</li>
<li>Systemd services</li>
<li>Systemd tmpfiles</li>
<li>Sysctl settings</li>
</ul>

<h3>Facts</h3>

<h4>Fact: <code>mycontext</code> (context)</h4>

<p>String giving the current execution context, possible values are:</p>

<ul>
<li><code>installer</code>, in the OS installer system before the first boot (debian-installer or anaconda)</li>
<li><code>ondisk</code>, the system has been installed on disk and is running</li>
<li><code>diskless-preinit</code>, first run on a diskless system before downloading the system image</li>
<li><code>diskless-postinit</code>, the system has been booted from a diskless image and is running</li>
</ul>

<h4>Fact: <code>netconfig</code> (network)</h4>

<p>Hash defining for each interface the IP address to configure.</p>

<p>Same on all nodes.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">    netconfig: 
      eth0: 
        - &quot;10.100.4.1/255.255.248.0&quot;
      bond1: 
        - &quot;192.168.42.47/255.255.255.0&quot;
        - &quot;192.168.42.57/255.255.255.0&quot;
</code></pre>

<h4>Fact: <code>dhcpconfig</code> (network)</h4>

<p>Hash defining for each node in the HPC cluster a pair macaddress/ipaddress.</p>

<p>Same on all nodes.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">    dhcpconfig: 
      genadmin1: 
        macaddress: &quot;52:54:00:c1:c4:9c&quot;
        ipaddress: &quot;10.100.0.1&quot;
      gencritical1: 
        macaddress: &quot;52:54:00:65:e5:74&quot;
        ipaddress: &quot;10.100.2.11&quot;
      gencritical2: 
        macaddress: &quot;52:54:00:48:63:38&quot;
        ipaddress: &quot;10.100.2.12&quot;
</code></pre>

<h4>Fact: <code>hostfile</code> (network)</h4>

<p>For each node give the hostname/ip address association. </p>

<p>Same on all nodes.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">    hostfile: 
      genadmin1: &quot;10.100.0.1&quot;
      extgenadmin1: &quot;192.168.42.41&quot;
      gencritical1: &quot;10.100.2.11&quot;
      gencritical: &quot;10.100.2.10&quot;
      extgencritical1: &quot;192.168.42.43&quot;
      extgencritical: &quot;192.168.42.53&quot;
      gencritical2: &quot;10.100.2.12&quot;
      extgencritical2: &quot;192.168.42.44&quot;
</code></pre>

<h4>Fact: <code>ifaces_target</code> (network)</h4>

<p><strong>DEPRECATED</strong></p>

<h4>Fact: <code>mymasternet</code> (network)</h4>

<p><code>master_network</code> info for the current node.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">    mymasternet: 
      fqdn: cladmin1.cluster.hpc.example.com
      networks: 
        administration: 
          DHCP_MAC: &quot;0d:bf:3d:a9:aa:02&quot;
          IP: &quot;10.1.1.11&quot;
          device: bond1
          hostname: cladmin1
        lowlatency: 
          IP: &quot;10.1.2.11&quot;
          device: ib0
          hostname: ibcladmin1
        bmc: 
          DHCP_MAC: &quot;0d:bf:3d:a9:aa:05&quot;
          IP: &quot;172.16.1.32&quot;
          hostname: wanbmccladmin1
        management: 
          IP: &quot;10.1.0.211&quot;
          device: bond1
          hostname: mgtcladmin1
        wan: 
          IP: &quot;172.16.1.1&quot;
          device: bond2
          hostname: wancladmin1
</code></pre>

<h4>Fact: <code>mynet_topology</code> (network)</h4>

<p>Network topology from the perspective of the current node, gives where each network is connected on the current node (<code>interfaces</code>) and the name of the network.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">    mynet_topology: 
      administration:
        interfaces: 
          - eth0
        name: CLUSTER
        firewall_zone: clstr
        external_config: false
      wan: 
        interfaces: 
          - bond1
        name: EXT
        firewall_zone: wan
        external_config: false

</code></pre>

<h4>Fact: <code>myprofiles</code> (profiles)</h4>

<p>Array of active profiles on the current node.</p>

<h4>Fact: <code>profiles</code> (profiles)</h4>

<p>Hash with roles as keys and array of active profiles for this node type as value.</p>

<h4>Fact: <code>my_XXXXX_{server,relay,mirror,replica,tracker,proxy}</code> (profiles)</h4>

<p>Those facts give for each profile <code>profiles::XXXXXX::{server,relay,mirror,replica,tracker,proxy}</code> which role has the profile defined. This value can then be used elsewhere in the configuration to configure the clients.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">    my_conman_server: misc
    my_ntp_server: critical
    my_dns_server: critical
    my_postfix_relay: misc
</code></pre>

<h4>Fact: <code>puppet_role</code> (roles)</h4>

<p>Roles are derived from the name of the node: <code>&lt;cluster_prefix&gt;&lt;role&gt;&lt;numerical_id&gt;</code>. The <code>cluster_prefix</code> is read from hiera. If nothing matches, the role is <code>default</code>. </p>

<h4>Fact: <code>puppet_index</code> (roles)</h4>

<p>Index are derived from the name of the node: <code>&lt;cluster_prefix&gt;&lt;role&gt;&lt;numerical_id&gt;</code>. The <code>cluster_prefix</code> is read from hiera. If nothing matches, the index is <code>default</code>. </p>

<h4>Fact: <code>hosts_by_role</code> (roles)</h4>

<p>Hash giving a list of hostnames by role, the source is the <code>hostfile</code> fact (see above). All host names matching the rule of <code>puppet_role</code> will be included, <code>default</code> role is not included.</p>

<pre class="code ~"><code class="~">    hosts_by_role: 
      admin: 
        - genadmin1
      critical: 
        - gencritical1
        - gencritical2
      misc: 
        - genmisc1
        - genmisc2
      batch: 
        - genbatch1
        - genbatch2
      front: 
        - genfront1
      cn: 
        - gencn01
</code></pre>

<h3>Functions</h3>

<p>Function are described more completely in the code comments.</p>

<h4>Function: <code>decrypt($target, $passwd)</code></h4>

<p>Decrypts the file <code>$target</code> with key: <code>$passwd</code>.</p>

<h4>Function: <code>hpc_atoh($array)</code></h4>

<p>Returns a hash with array values as keys.</p>

<h4>Function: <code>hpc_dns_zones()</code></h4>

<p>Returns a hash describing <code>::dns::server::zones</code> resources for the current cluster.</p>

<h4>Function: <code>hpc_get_hosts_by_profile($profile)</code></h4>

<p>Returns an array with the hosts that have the profile given in
parameter.</p>

<h4>Function: <code>hpc_ha_vip_notify_scripts()</code></h4>

<p>Returns a hash describing <code>::hpc_ha::vip_notify_script</code> resources for the current host.
List comes from hiera.</p>

<h4>Function: <code>hpc_ha_vips()</code></h4>

<p>Returns a hash describing <code>::hpc_ha::vip</code> resources for the current host. List
comes from hiera.</p>

<h4>Function: <code>hpc_ha_vservs()</code></h4>

<p>Returns a hash describing <code>::hpc_ha::vserv</code> resources for the current host. List
comes from hiera.</p>

<h4>Function: <code>hpc_hmap($hash, $key)</code></h4>

<p>Transforms a hash of value into a hash of hash. </p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_hpc_hmap'>hpc_hmap</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>K</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<p>returns:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>K</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rbrace'>}</span>
</code></pre>

<h4>Function: <code>hpc_nodeset_expand($nodeset)</code></h4>

<p>Transforms a ClusterShell nodeset into an array of hostnames.</p>

<h4>Function: <code>hpc_nodeset_fold($array)</code></h4>

<p>Transforms an array of hostnames into a ClusterShell nodeset.</p>

<h4>Function: <code>hpc_roles_nodeset($roles)</code></h4>

<p>Returns a hash where the keys are the roles passed as parameters and the
values are the ClusterShell nodeset of all the machines having that role
in the configuration.</p>

<h4>Function: <code>hpc_roles_single_nodeset($roles)</code></h4>

<p>Returns a ClusterShell nodeset of all the machines having one of the roles
given in the array in parameter.</p>

<h4>Function: <code>hpc_shorewall_interfaces()</code></h4>

<p>Reads the <code>firewall_zone</code> parameter in the network topology definition and
returns a hash of describing <code>::shorewall::interface</code> for the current host.</p>

<h4>Function: <code>hpc_source_file($source)</code></h4>

<p>Returns the content of a file read from the source. The source can be:</p>

<ul>
<li>An absolute file path</li>
<li>A relative file path refers to a module <code>files</code> directory (<code>&lt;module&gt;/&lt;file_path&gt;</code>)</li>
<li>An URL (<code>file://</code> or <code>http://</code>)</li>
</ul>

<p>If <code>$source</code> is an array, all sources are tried successively.</p>

<h2>Limitations</h2>

<p>This module is mainly tested on Debian, but is meant to also work with RHEL and
derivatives.</p>

<h2>Development</h2>

<p>Patches and issues can be submitted on GitHub:
<a href="https://github.com/edf-hpc/puppet-hpc">https://github.com/edf-hpc/puppet-hpc</a></p>
</div></div>

    <div id="footer">
  Generated on Fri Dec 16 17:40:52 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.5).
</div>

  </body>
</html>